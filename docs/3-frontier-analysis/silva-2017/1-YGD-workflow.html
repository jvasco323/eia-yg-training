<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workflow for Silva et al. (2017) &mdash; EiA YGD</title>
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Retrieve data from GYGA" href="2-YGD-gyga-data.html" />
    <link rel="prev" title="Stochastic frontier analysis" href="../index.html" /> 
</head>
<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Yield gap analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div>
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../0-install-r/1-introduction.html">Installing R</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../1-concepts/index.html">Concepts and definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../2-data-collection/index.html">Data collection tool</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../4-boundary-lines/index.html">Boundary line analysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Stochastic frontier analysis</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Workflow for Silva et al. (2017)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction"><strong>Introduction</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-required-r-packages"><strong>Load required R packages</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#farmer-field-data"><strong>Farmer field data</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-manipulation"><strong>Data manipulation</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#descriptive-statistics"><strong>Descriptive statistics</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#efficiency-yield-gap"><strong>Efficiency yield gap</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#resource-yield-gap"><strong>Resource yield gap</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#technology-yield-gap"><strong>Technology yield gap</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#yield-gap-decomposition"><strong>Yield gap decomposition</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#recommendations"><strong>Recommendations</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#acknowledgments"><strong>Acknowledgments</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2-YGD-gyga-data.html">Retrieve data from GYGA</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../5-machine-learning/index.html">Interpretable machine learning</a></li>
</ul>
        </div>
      </div>
    </nav>
    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" aria-label="top navigation">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Yield gap analysis</a>
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content">
<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html">Docs</a> &raquo;</li>
          <li><a href="../index.html">Stochastic frontier analysis</a> &raquo;</li>
      <li>Workflow for Silva et al. (2017)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/3-frontier-analysis/silva-2017/1-YGD-workflow.R.txt" rel="nofollow"> <em>R</em> code</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
  <div class="section" id="workflow-for-silva-et-al-2017">
<h1>Workflow for Silva et al. (2017)<a class="headerlink" href="#workflow-for-silva-et-al-2017" title="Permalink to this headline">¶</a></h1>
<p><strong>João Vasco Silva</strong>, CIMMYT-Zimbabwe</p>
<hr class="docutils" />
<div class="section" id="introduction">
<h2><strong>Introduction</strong><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Yield gap decomposition has been increasingly applied in agronomy to
disentangle the impact of sub-optimal management on crop production and
to identify agronomic measures to improve yields. To date, most
applications refer to cereal crops (and some tuber and root crops) in a
wide range of production systems worldwide, particularly in sub-Saharan
Africa, South and Southeast Asia, and Northwest Europe. This notebook
aims to formalize the R scripts used to decompose yield gaps across most
of those applications making use of the framework introduced by <a class="reference external" href="https://doi.org/10.1016/j.eja.2016.06.017">Silva
et al. (2017)</a>. Data
collected by CIMMYT and EIAR for wheat in Ethiopia, previously used for
yield gap analysis (<a class="reference external" href="https://doi.org/10.1007/s13593-020-00654-z">Silva et al.,
2021</a>), are used here as
an example. Before diving into the R scripts it is important to
understand the key concepts and definitions involved in yield gap
decomposition as these determine how the different yield levels and
associated yield gaps are estimated.</p>
<p>The framework for yield gap decomposition described in this notebook
considers four different yield levels (<a class="reference external" href="https://doi.org/10.1016/j.eja.2016.06.017">Silva et al.,
2017</a>). First, the
<strong>water-limited potential yield</strong> (Yw) refers to the maximum yield that
can be obtained under rainfed conditions in a well-defined, and
relatively homogeneous, biophysical environment (<a class="reference external" href="https://doi.org/10.1016/j.fcr.2012.09.009">van Ittersum et al.,
2013</a>). Yw can be
simulated with crop growth models or derived from field trials with
non-limiting levels of nutrients and pests, diseases, and weeds fully
controlled. Second, the <strong>highest farmers’ yield</strong> (Y<sub>HF</sub>) refer
to the maximum yields (e.g. average above the 90th percentile of actual
farmers’ yields) observed in a representative sample of farmers sharing
similar biophysical conditions (weather and soils) and technologies
adopted (e.g., varieties). Third, the <strong>technical efficient yield</strong>
(Y<sub>TEx</sub>) comprises the maximum yield that can be achieved by
farmers in a given production ecology for a given input level and can be
computed using methods of frontier analysis in combination with concepts
of production ecology (<a class="reference external" href="https://doi.org/10.1016/j.eja.2016.06.017">Silva et al.,
2017</a>). Finally, the
<strong>actual yield</strong> (Ya) refers to the yield in farmers’ fields as recorded
in farm surveys.</p>
<p><a class="reference internal" href="../../_images/framework.png"><img alt="image1" src="../../_images/framework.png" style="width: 62.5%;" /></a></p>
<p><strong>Figure 1</strong>. Visual illustration of the yield levels, and respective
yield gaps, considered in the yield gap decomposition presented in this
workflow. Source: <a class="reference external" href="https://doi.org/10.1016/j.eja.2016.06.017">Silva et
al. (2017)</a>.</p>
<p>The total yield gap and three intermediate yield gaps can be estimated
using the four yield levels previously described. The <strong>total yield
gap</strong> is calculated as the difference between Yw and Ya. The
<strong>efficiency yield gap</strong> is calculated as the difference between
Y<sub>TEx</sub> and Ya and it can be explained by crop management
imperfections related to time, form, and/or space of the inputs applied.
The <strong>resource yield gap</strong> is calculated as the difference between
Y<sub>HF</sub> and Y<sub>TEx</sub> and captures the yield penalty due to a
sub-optimal amount of inputs applied. Lastly, the <strong>technology yield
gap</strong> is calculated as the difference between Yw and Y<sub>HF</sub>, which
can be explained by resource yield gaps of specific inputs and/or
absence of certain technologies that would fully exploit the biophysical
potential of the system. Please note Ya and the intermediate yield gaps
can be expressed as a percentage of Yw, reflecting the current yield gap
closure and the share of yield gap explained by each intermediate yield
gap.</p>
</div>
<hr class="docutils" />
<div class="section" id="load-required-r-packages">
<h2><strong>Load required R packages</strong><a class="headerlink" href="#load-required-r-packages" title="Permalink to this headline">¶</a></h2>
<p>First, we need to load the R packages needed to run this workflow.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># package names</span>
<span class="n">packages</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;frontier&quot;</span><span class="p">,</span> <span class="s">&quot;dplyr&quot;</span><span class="p">,</span> <span class="s">&quot;tidyr&quot;</span><span class="p">,</span> <span class="s">&quot;knitr&quot;</span><span class="p">,</span> <span class="s">&quot;car&quot;</span><span class="p">,</span> <span class="s">&quot;RColorBrewer&quot;</span><span class="p">,</span> <span class="s">&quot;DT&quot;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># install packages</span>
<span class="n">installed_packages</span> <span class="o">&lt;-</span> <span class="n">packages</span> <span class="o">%in%</span> <span class="nf">rownames</span><span class="p">(</span><span class="nf">installed.packages</span><span class="p">())</span>
<span class="nf">if </span><span class="p">(</span><span class="nf">any</span><span class="p">(</span><span class="n">installed_packages</span> <span class="o">==</span> <span class="kc">FALSE</span><span class="p">)){</span>
  <span class="nf">install.packages</span><span class="p">(</span><span class="n">packages</span><span class="p">[</span><span class="o">!</span><span class="n">installed_packages</span><span class="p">])}</span>
<span class="c1">## Installing package into &#39;C:/Users/JSILVA/OneDrive - CIMMYT/Documents/R/win-library/4.0&#39;</span>
<span class="c1">## (as &#39;lib&#39; is unspecified)</span>
<span class="c1">## Error in contrib.url(repos, &quot;source&quot;): trying to use CRAN without setting a mirror</span>
<span class="c1">#</span>
<span class="c1"># load packages</span>
<span class="nf">invisible</span><span class="p">(</span><span class="nf">lapply</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="nf">suppressMessages</span><span class="p">(</span><span class="nf">require</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">character.only</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">quietly</span><span class="o">=</span><span class="bp">T</span><span class="p">,</span> <span class="n">warn.conflicts</span><span class="o">=</span><span class="bp">F</span><span class="p">))))</span>
<span class="c1">## Warning: package &#39;lmtest&#39; was built under R version 4.0.5</span>
<span class="c1">## Warning: package &#39;dplyr&#39; was built under R version 4.0.5</span>
<span class="c1">## Warning: package &#39;knitr&#39; was built under R version 4.0.5</span>
<span class="c1">## Warning: package &#39;car&#39; was built under R version 4.0.5</span>
<span class="c1">## Warning: package &#39;carData&#39; was built under R version 4.0.5</span>
<span class="c1">## Warning in library(package, lib.loc = lib.loc, character.only = TRUE,</span>
<span class="c1">## logical.return = TRUE, : there is no package called &#39;DT&#39;</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="farmer-field-data">
<h2><strong>Farmer field data</strong><a class="headerlink" href="#farmer-field-data" title="Permalink to this headline">¶</a></h2>
<p>The first step is to load the farmer field data to be used for yield gap
analysis. The data contain (a) primary data on self-reported Ya,
management practices, and biophysical conditions at field level obtained
through a household survey, and (b) secondary data obtained from spatial
products using the GPS coordinates of the individual households. The
household survey is a panel of households over two growing seasons (2009
and 2013). Type and sources of secondary data include: climate zones
from the Global Yield Gap Atlas (<a class="reference external" href="https://doi.org/10.1016/j.fcr.2012.11.023">van Wart et al.,
2013</a>), soil water
properties from AfSIS-GYGA (<a class="reference external" href="https://doi.org/10.1088/1748-9326/aa9003">Leenaars et al.,
2017</a>), agro-ecological
zones for Ethiopia, and farming systems classification for Africa.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># read .csv file with data</span>
<span class="n">file</span> <span class="o">&lt;-</span> <span class="s">&#39;https://raw.githubusercontent.com/jvasco323/EiA_YGD_workflow/main/data-wheat-ethiopia.csv&#39;</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="nf">url</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
<span class="c1">#</span>
<span class="c1"># list variables of interest</span>
<span class="nf">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="c1">## &#39;data.frame&#39;:    3783 obs. of  42 variables:</span>
<span class="c1">##  $ zone                 : chr  &quot;WEST SHOA&quot; &quot;WEST SHOA&quot; &quot;WEST SHOA&quot; &quot;WEST SHOA&quot; ...</span>
<span class="c1">##  $ zone_new             : chr  &quot;W SHOA&quot; &quot;W SHOA&quot; &quot;W SHOA&quot; &quot;W SHOA&quot; ...</span>
<span class="c1">##  $ farming_system       : chr  &quot;6. Highland mixed farming system&quot; &quot;6. Highland mixed farming system&quot; &quot;6. Highland mixed farming system&quot; &quot;6. Highland mixed farming system&quot; ...</span>
<span class="c1">##  $ aez                  : chr  &quot;M2&quot; &quot;M2&quot; &quot;M2&quot; &quot;M2&quot; ...</span>
<span class="c1">##  $ year                 : int  2009 2009 2009 2009 2009 2009 2009 2009 2009 2009 ...</span>
<span class="c1">##  $ season_year          : chr  &quot;Meher_2009&quot; &quot;Meher_2009&quot; &quot;Meher_2009&quot; &quot;Meher_2009&quot; ...</span>
<span class="c1">##  $ hhid                 : int  1 11 11 16 17 270 281 285 292 515 ...</span>
<span class="c1">##  $ plotid               : int  5 2 2 5 2 2 6 6 4 2 ...</span>
<span class="c1">##  $ subplotid            : int  1 4 3 1 3 1 1 1 1 1 ...</span>
<span class="c1">##  $ subplotsize_ha       : num  0.5 0.5 0.0625 1 1.5 0.5 0.25 0.25 1.5 0.5 ...</span>
<span class="c1">##  $ subplot_own          : chr  &quot;Rented-in&quot; &quot;Owned&quot; &quot;Owned&quot; &quot;Rented-in&quot; ...</span>
<span class="c1">##  $ subplot_manager      : chr  &quot;Man&quot; &quot;Man&quot; &quot;Man&quot; &quot;Man&quot; ...</span>
<span class="c1">##  $ plotdist_min         : num  10 5 2 15 10 5 15 30 5 5 ...</span>
<span class="c1">##  $ crop                 : chr  &quot;Wheat_br&quot; &quot;Wheat_br&quot; &quot;Wheat_br&quot; &quot;Wheat_br&quot; ...</span>
<span class="c1">##  $ gyga_cz              : int  5501 5501 5501 5501 5501 5501 5501 5501 5501 5501 ...</span>
<span class="c1">##  $ gyga_gdd             : num  6539 6539 6539 6539 6539 ...</span>
<span class="c1">##  $ gyga_tseas           : int  1208 1208 1208 1208 1208 1285 1200 1200 1200 1208 ...</span>
<span class="c1">##  $ seed_kgha            : num  206 250 192 64 33.3 ...</span>
<span class="c1">##  $ variety              : chr  &quot;Landrace&quot; &quot;unknown&quot; &quot;unknown&quot; &quot;unknown&quot; ...</span>
<span class="c1">##  $ gyga_ai              : num  6544 6544 6544 6544 6544 ...</span>
<span class="c1">##  $ gyga_av_water        : int  9 9 9 9 9 7 7 7 7 9 ...</span>
<span class="c1">##  $ soil_depth           : chr  &quot;Deep&quot; &quot;Deep&quot; &quot;Medium&quot; &quot;Medium&quot; ...</span>
<span class="c1">##  $ soil_slope           : chr  &quot;Medium&quot; &quot;Steep&quot; &quot;Steep&quot; &quot;Flat&quot; ...</span>
<span class="c1">##  $ waterlogging_yn      : chr  &quot;No&quot; &quot;No&quot; &quot;No&quot; &quot;No&quot; ...</span>
<span class="c1">##  $ drought_yn           : chr  &quot;No&quot; &quot;No&quot; &quot;Yes&quot; &quot;No&quot; ...</span>
<span class="c1">##  $ soilwatercons_yn     : chr  &quot;Yes&quot; &quot;Yes&quot; &quot;Yes&quot; &quot;No&quot; ...</span>
<span class="c1">##  $ oxplough_freq        : int  5 4 4 4 8 4 3 5 4 5 ...</span>
<span class="c1">##  $ oxplough_freq_cat    : chr  &quot;&gt;Five&quot; &quot;Four&quot; &quot;Four&quot; &quot;Four&quot; ...</span>
<span class="c1">##  $ soil_fertility       : chr  &quot;Poor&quot; &quot;Poor&quot; &quot;Poor&quot; &quot;Poor&quot; ...</span>
<span class="c1">##  $ nfert_kgha           : num  32.3 41.3 51.7 32.3 21.5 ...</span>
<span class="c1">##  $ pfert_kgha           : num  10.04 20.07 16.06 10.04 6.69 ...</span>
<span class="c1">##  $ manure_yn            : chr  &quot;No&quot; &quot;No&quot; &quot;No&quot; &quot;No&quot; ...</span>
<span class="c1">##  $ residues_yn          : chr  &quot;No&quot; &quot;Yes&quot; &quot;Yes&quot; &quot;Yes&quot; ...</span>
<span class="c1">##  $ previous_crop        : chr  &quot;Cereal&quot; &quot;Cereal&quot; &quot;Cereal&quot; &quot;Cereal&quot; ...</span>
<span class="c1">##  $ herb_lha             : num  0.4 2 4 1 0.2 ...</span>
<span class="c1">##  $ handweeding_persdayha: num  24 8 64 20 16 0 16 28 0 22 ...</span>
<span class="c1">##  $ weeding_freq         : int  1 1 1 1 1 0 2 1 1 1 ...</span>
<span class="c1">##  $ weeding_freq_cat     : chr  &quot;One&quot; &quot;One&quot; &quot;One&quot; &quot;One&quot; ...</span>
<span class="c1">##  $ pesticide_yn         : chr  &quot;No&quot; &quot;No&quot; &quot;No&quot; &quot;No&quot; ...</span>
<span class="c1">##  $ disease_incidence_yn : chr  &quot;No&quot; &quot;Yes&quot; &quot;No&quot; &quot;Yes&quot; ...</span>
<span class="c1">##  $ pest_incidence_yn    : chr  &quot;Yes&quot; &quot;No&quot; &quot;No&quot; &quot;No&quot; ...</span>
<span class="c1">##  $ yield_tha            : num  1.2 2.4 3.2 1 0.267 ...</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="data-manipulation">
<h2><strong>Data manipulation</strong><a class="headerlink" href="#data-manipulation" title="Permalink to this headline">¶</a></h2>
<p>Some data transformations need to be done prior to the analysis. These
include (a) re-leveling and re-classification of categorical variables,
(b) log-transformation of continuous variables so that model
coefficients can be interpreted as elasticities, and (c) fill or drop
data not available. If needed, missing data for specific observations of
a given variable can be filled with the average value for that variable.
This is documented in the chunk of code below.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># create final data</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">yield_tha</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">)</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">residues_yn</span> <span class="o">==</span> <span class="s">&quot;No&quot;</span> <span class="o">|</span> <span class="n">residues_yn</span> <span class="o">==</span> <span class="s">&quot;Yes&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">soil_slope</span> <span class="o">==</span> <span class="s">&quot;Flat&quot;</span> <span class="o">|</span> <span class="n">soil_slope</span> <span class="o">==</span> <span class="s">&quot;Medium&quot;</span> <span class="o">|</span> <span class="n">soil_slope</span> <span class="o">==</span> <span class="s">&quot;Steep&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">zone_new</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">oxplough_freq_cat</span> <span class="o">==</span> <span class="s">&quot;&lt;Two&quot;</span> <span class="o">|</span>
                     <span class="n">oxplough_freq_cat</span> <span class="o">==</span> <span class="s">&quot;Three&quot;</span> <span class="o">|</span>
                     <span class="n">oxplough_freq_cat</span> <span class="o">==</span> <span class="s">&quot;Four&quot;</span> <span class="o">|</span>
                     <span class="n">oxplough_freq_cat</span> <span class="o">==</span> <span class="s">&quot;&gt;Five&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">weeding_freq_cat</span> <span class="o">==</span> <span class="s">&quot;None&quot;</span> <span class="o">|</span>
                     <span class="n">weeding_freq_cat</span> <span class="o">==</span> <span class="s">&quot;One&quot;</span> <span class="o">|</span>
                     <span class="n">weeding_freq_cat</span> <span class="o">==</span> <span class="s">&quot;Two&quot;</span> <span class="o">|</span>
                     <span class="n">weeding_freq_cat</span> <span class="o">==</span> <span class="s">&quot;Three+&quot;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># fill NA values</span>
<span class="n">data</span><span class="o">$</span><span class="n">seed_kgha</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">seed_kgha</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">seed_kgha</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">nfert_kgha</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">nfert_kgha</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="m">0</span>
<span class="n">data</span><span class="o">$</span><span class="n">herb_lha</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">herb_lha</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="m">0</span>
<span class="n">data</span><span class="o">$</span><span class="n">handweeding_persdayha</span><span class="p">[</span><span class="nf">is.na</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">handweeding_persdayha</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="m">0</span>
<span class="c1">#</span>
<span class="c1"># reclassify categorical variables</span>
<span class="n">data</span><span class="o">$</span><span class="n">variety</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">variety</span> <span class="o">!=</span> <span class="s">&#39;Landrace&#39;</span> <span class="o">&amp;</span>  <span class="n">data</span><span class="o">$</span><span class="n">variety</span> <span class="o">!=</span> <span class="s">&#39;unknown&#39;</span><span class="p">,</span> <span class="s">&#39;Improved&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">$</span><span class="n">variety</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">variety</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">variety</span> <span class="o">==</span> <span class="s">&#39;Landrace&#39;</span><span class="p">,</span> <span class="s">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">$</span><span class="n">variety</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">nfert_yn</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">nfert_kgha</span> <span class="o">==</span> <span class="m">0</span><span class="p">,</span> <span class="s">&#39;N0&#39;</span><span class="p">,</span> <span class="s">&#39;N+&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">$</span><span class="n">weeding_yn</span> <span class="o">=</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">herb_lha</span> <span class="o">==</span> <span class="m">0</span> <span class="o">&amp;</span> <span class="n">data</span><span class="o">$</span><span class="n">handweeding_persdayha</span> <span class="o">==</span> <span class="m">0</span><span class="p">,</span> <span class="s">&#39;No&#39;</span><span class="p">,</span> <span class="s">&#39;Yes&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># copy df with transformed data</span>
<span class="n">data_new</span> <span class="o">&lt;-</span> <span class="n">data</span>
<span class="c1">#</span>
<span class="c1"># replace 0 with small value for log-transformation</span>
<span class="n">data_new</span><span class="p">[</span><span class="n">data_new</span> <span class="o">==</span> <span class="m">0</span><span class="p">]</span> <span class="o">=</span> <span class="m">0.0001</span>
<span class="c1">#</span>
<span class="c1"># log-transform continuous variables</span>
<span class="n">vars1</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;gyga_gdd&#39;</span><span class="p">,</span> <span class="s">&#39;gyga_tseas&#39;</span><span class="p">,</span> <span class="s">&#39;seed_kgha&#39;</span><span class="p">,</span> <span class="s">&#39;gyga_ai&#39;</span><span class="p">,</span> <span class="s">&#39;gyga_av_water&#39;</span><span class="p">,</span> <span class="s">&#39;nfert_kgha&#39;</span><span class="p">,</span> <span class="s">&#39;pfert_kgha&#39;</span><span class="p">,</span>
           <span class="s">&#39;herb_lha&#39;</span><span class="p">,</span> <span class="s">&#39;handweeding_persdayha&#39;</span><span class="p">,</span> <span class="s">&#39;yield_tha&#39;</span><span class="p">)</span>
<span class="n">log_f</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="nf">log</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
<span class="n">data_new</span><span class="p">[,</span><span class="n">vars1</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">data_new</span><span class="p">[,</span><span class="n">vars1</span><span class="p">],</span> <span class="n">log_f</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># set categorical variables to factor</span>
<span class="n">vars2</span> <span class="o">&lt;-</span> <span class="nf">c</span><span class="p">(</span><span class="s">&#39;farming_system&#39;</span><span class="p">,</span> <span class="s">&#39;aez&#39;</span><span class="p">,</span> <span class="s">&#39;zone_new&#39;</span><span class="p">,</span> <span class="s">&#39;season_year&#39;</span><span class="p">,</span> <span class="s">&#39;variety&#39;</span><span class="p">,</span> <span class="s">&#39;soil_depth&#39;</span><span class="p">,</span> <span class="s">&#39;soil_fertility&#39;</span><span class="p">,</span>
           <span class="s">&#39;waterlogging_yn&#39;</span><span class="p">,</span> <span class="s">&#39;drought_yn&#39;</span><span class="p">,</span> <span class="s">&#39;soilwatercons_yn&#39;</span><span class="p">,</span> <span class="s">&#39;manure_yn&#39;</span><span class="p">,</span> <span class="s">&#39;residues_yn&#39;</span><span class="p">,</span> <span class="s">&#39;previous_crop&#39;</span><span class="p">,</span>
           <span class="s">&#39;oxplough_freq_cat&#39;</span><span class="p">,</span> <span class="s">&#39;weeding_yn&#39;</span><span class="p">,</span> <span class="s">&#39;pesticide_yn&#39;</span><span class="p">,</span> <span class="s">&#39;disease_incidence_yn&#39;</span><span class="p">,</span> <span class="s">&#39;pest_incidence_yn&#39;</span><span class="p">)</span>
<span class="n">data_new</span><span class="p">[,</span><span class="n">vars2</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">lapply</span><span class="p">(</span><span class="n">data_new</span><span class="p">[,</span><span class="n">vars2</span><span class="p">],</span> <span class="n">factor</span><span class="p">)</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="descriptive-statistics">
<h2><strong>Descriptive statistics</strong><a class="headerlink" href="#descriptive-statistics" title="Permalink to this headline">¶</a></h2>
<p>Descriptive statistics of the actual yield and (continuous) crop
management variables used in the analysis for the 2 years of the survey
are provided below. Actual yield of wheat across Ethiopia was on average
1.76 t/ha in 2009 and 1.77 t/ha in 2013. N and P application rates were
on average 48 kg N/ha and 20 kg P/ha, respectively. Plot sizes were on
average 0.45 ha in 2009 and 0.40 ha in 2013.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 42%" />
<col style="width: 14%" />
<col style="width: 14%" />
<col style="width: 15%" />
<col style="width: 15%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Mean 2009</p></th>
<th class="head"><p>Mean 2013</p></th>
<th class="head"><p>StDev 2009</p></th>
<th class="head"><p>StDev 2013</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Hand-weeding (person-day/ha)</p></td>
<td><p>21.84</p></td>
<td><p>24.28</p></td>
<td><p>30.46</p></td>
<td><p>35.46</p></td>
</tr>
<tr class="row-odd"><td><p>Herbicide use (L/ha)</p></td>
<td><p>0.5</p></td>
<td><p>0.59</p></td>
<td><p>0.83</p></td>
<td><p>0.88</p></td>
</tr>
<tr class="row-even"><td><p>N application rate (kg N/ha)</p></td>
<td><p>48.07</p></td>
<td><p>48.99</p></td>
<td><p>40.53</p></td>
<td><p>32.04</p></td>
</tr>
<tr class="row-odd"><td><p>P application rate (kg P/ha)</p></td>
<td><p>19.63</p></td>
<td><p>20.34</p></td>
<td><p>13.93</p></td>
<td><p>12.36</p></td>
</tr>
<tr class="row-even"><td><p>Seed rate (kg/ha)</p></td>
<td><p>192.88</p></td>
<td><p>195.43</p></td>
<td><p>79.85</p></td>
<td><p>95.66</p></td>
</tr>
<tr class="row-odd"><td><p>Plot size (ha)</p></td>
<td><p>0.45</p></td>
<td><p>0.4</p></td>
<td><p>0.39</p></td>
<td><p>0.3</p></td>
</tr>
<tr class="row-even"><td><p>Actual wheat yield (t/ha)</p></td>
<td><p>1.76</p></td>
<td><p>1.77</p></td>
<td><p>1.13</p></td>
<td><p>1.09</p></td>
</tr>
</tbody>
</table>
</div>
<hr class="docutils" />
<div class="section" id="efficiency-yield-gap">
<h2><strong>Efficiency yield gap</strong><a class="headerlink" href="#efficiency-yield-gap" title="Permalink to this headline">¶</a></h2>
<p>A stochastic frontier model is needed to estimate Y<sub>TEx</sub> and the
efficiency yield gap. Stochastic frontier analysis is an econometric
technique widely used for benchmarking different production units
(<a class="reference external" href="https://doi.org/10.1017/CBO9781139174411">Kumbhakar &amp; Lovell,
2000</a>). Stochastic
frontiers differentiate two random errors: technical inefficiency,
<em>ui</em> (translated in agronomic terms as the efficiency yield gap), and
random noise, <em>vi</em>, hence separating the effects of sub-optimal crop
management (<em>ui</em>) from random noise (<em>vi</em>) in the response variable.
For yield gap analysis, the variables used to estimate stochastic
frontiers need to be selected based on principles of production ecology
(<a class="reference external" href="https://doi.org/10.1016/S0378-4290(97)00037-3">van Ittersum &amp; Rabbinge,
1997</a>) to capture the
impact of growth-defining, -limiting, and -reducing factors on crop
yield.</p>
<p>It is important to fit an <strong>ordinary least squares (OLS) regression</strong>
prior to fit a stochastic frontier. Although both models have the same
structure, and should exhibit similar signs and effect sizes for the
different variables, OLS regressions allow the computation of Variance
Inflation Factors (VIF) and hence to assess multicolinearity between
variables. As a rule-of-thumb, VIF values above 10 indicate
multicolinearity between variables, which is helpful to screen the final
set of variables to be included in the model (see:
<a class="reference external" href="https://en.wikipedia.org/wiki/Variance_inflation_factor">https://en.wikipedia.org/wiki/Variance_inflation_factor</a>). Please note
the VIF values and parameter estimates are not shown, but can be
obtained by removing the symbol # in the chunk of code below.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit ols regression model</span>
<span class="n">ols</span> <span class="o">&lt;-</span>
  <span class="nf">lm</span><span class="p">(</span><span class="n">yield_tha</span> <span class="o">~</span>
     <span class="n">season_year</span> <span class="o">+</span> <span class="n">gyga_gdd</span> <span class="o">+</span> <span class="n">gyga_tseas</span> <span class="o">+</span> <span class="n">seed_kgha</span> <span class="o">+</span> <span class="n">variety</span> <span class="o">+</span>
     <span class="n">gyga_ai</span> <span class="o">+</span> <span class="n">gyga_av_water</span> <span class="o">+</span> <span class="n">soil_depth</span> <span class="o">+</span> <span class="n">soil_fertility</span> <span class="o">+</span> <span class="n">waterlogging_yn</span> <span class="o">+</span> <span class="n">drought_yn</span> <span class="o">+</span> <span class="n">soilwatercons_yn</span> <span class="o">+</span>
     <span class="n">nfert_kgha</span> <span class="o">+</span> <span class="n">manure_yn</span> <span class="o">+</span> <span class="n">residues_yn</span> <span class="o">+</span> <span class="n">previous_crop</span> <span class="o">+</span> <span class="n">oxplough_freq_cat</span> <span class="o">+</span>
     <span class="n">herb_lha</span> <span class="o">+</span> <span class="n">handweeding_persdayha</span> <span class="o">+</span> <span class="n">weeding_yn</span> <span class="o">+</span> <span class="n">pesticide_yn</span> <span class="o">+</span> <span class="n">disease_incidence_yn</span> <span class="o">+</span> <span class="n">pest_incidence_yn</span><span class="p">,</span>
     <span class="n">data</span><span class="o">=</span><span class="n">data_new</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># check vif values</span>
<span class="c1"># vif(ols)</span>
<span class="c1">#</span>
<span class="c1"># see parameter estimates</span>
<span class="c1"># summary(ols)</span>
</pre></div>
</div>
<p>The OLS regression fitted above can now be fitted as a <strong>stochastic
frontier model with a Cobb-Douglas functional form</strong>. The Cobb-Douglas
functional form takes only the first-order terms and is thus the
simplest model that can be fit to the data. Two functions from the R
package <em>frontier</em> are used here: (1) the function <em>sfa()</em> is used to
estimate model parameters and, (2) the function <em>efficiencies()</em> is used
to estimate the technical efficiency scores (or the equivalent
efficiency yield gap in agronomy). Further information about the
theoretical background of these functions can be found in <a class="reference external" href="http://dx.doi.org/10.1007/BF00158774">Battese &amp;
Coelli (1992)</a>. This is
illustrated in the chunk of code below, which results are the same as
those presented in Table 3 of <a class="reference external" href="https://doi.org/10.1007/s13593-020-00654-z">Silva et
al. (2021)</a> for the
pooled data. The reader is thus referred to that manuscript for further
interpretation of model coefficients.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit cobb-douglas stochastic frontier</span>
<span class="n">sfa_cd</span> <span class="o">&lt;-</span>
  <span class="nf">sfa</span><span class="p">(</span><span class="n">yield_tha</span> <span class="o">~</span>
    <span class="n">season_year</span> <span class="o">+</span> <span class="n">gyga_gdd</span> <span class="o">+</span> <span class="n">gyga_tseas</span> <span class="o">+</span> <span class="n">seed_kgha</span> <span class="o">+</span> <span class="n">variety</span> <span class="o">+</span>
    <span class="n">gyga_ai</span> <span class="o">+</span> <span class="n">gyga_av_water</span> <span class="o">+</span> <span class="n">soil_depth</span> <span class="o">+</span> <span class="n">soil_fertility</span> <span class="o">+</span> <span class="n">waterlogging_yn</span> <span class="o">+</span> <span class="n">drought_yn</span> <span class="o">+</span> <span class="n">soilwatercons_yn</span> <span class="o">+</span>
    <span class="n">nfert_kgha</span> <span class="o">+</span> <span class="n">manure_yn</span> <span class="o">+</span> <span class="n">residues_yn</span> <span class="o">+</span> <span class="n">previous_crop</span> <span class="o">+</span> <span class="n">oxplough_freq_cat</span> <span class="o">+</span>
    <span class="n">herb_lha</span> <span class="o">+</span> <span class="n">handweeding_persdayha</span> <span class="o">+</span> <span class="n">weeding_yn</span> <span class="o">+</span> <span class="n">pesticide_yn</span> <span class="o">+</span> <span class="n">disease_incidence_yn</span> <span class="o">+</span> <span class="n">pest_incidence_yn</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_new</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># add technical efficiency score to data frame</span>
<span class="n">data_new</span><span class="o">$</span><span class="n">te_score_cd</span> <span class="o">=</span> <span class="nf">efficiencies</span><span class="p">(</span><span class="n">sfa_cd</span><span class="p">,</span> <span class="n">asInData</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># see parameter estimates</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">sfa_cd</span><span class="p">)</span>
<span class="c1">## Error Components Frontier (see Battese &amp; Coelli 1992)</span>
<span class="c1">## Inefficiency decreases the endogenous variable (as in a production function)</span>
<span class="c1">## The dependent variable is logged</span>
<span class="c1">## Iterative ML estimation terminated after 33 iterations:</span>
<span class="c1">## log likelihood values and parameters of two successive iterations</span>
<span class="c1">## are within the tolerance limit</span>
<span class="c1">##</span>
<span class="c1">## final maximum likelihood estimates</span>
<span class="c1">##                           Estimate Std. Error  z value  Pr(&gt;|z|)</span>
<span class="c1">## (Intercept)              9.7733888  1.1050740   8.8441 &lt; 2.2e-16 ***</span>
<span class="c1">## season_yearMeher_2013   -0.0539923  0.0264810  -2.0389  0.041460 *</span>
<span class="c1">## gyga_gdd                -0.5840446  0.0909876  -6.4189 1.372e-10 ***</span>
<span class="c1">## gyga_tseas              -0.3252022  0.0525343  -6.1903 6.006e-10 ***</span>
<span class="c1">## seed_kgha                0.0976523  0.0123652   7.8974 2.849e-15 ***</span>
<span class="c1">## varietyunknown          -0.0018340  0.0231824  -0.0791  0.936944</span>
<span class="c1">## gyga_ai                 -0.3311850  0.0594151  -5.5741 2.488e-08 ***</span>
<span class="c1">## gyga_av_water           -0.0080901  0.0412886  -0.1959  0.844658</span>
<span class="c1">## soil_depthMedium        -0.0742006  0.0232508  -3.1913  0.001416 **</span>
<span class="c1">## soil_depthShallow       -0.0812014  0.0291497  -2.7857  0.005342 **</span>
<span class="c1">## soil_fertilityMedium    -0.0568591  0.0203025  -2.8006  0.005101 **</span>
<span class="c1">## soil_fertilityPoor      -0.1627704  0.0309154  -5.2650 1.402e-07 ***</span>
<span class="c1">## waterlogging_ynYes      -0.3472614  0.0379737  -9.1448 &lt; 2.2e-16 ***</span>
<span class="c1">## drought_ynYes           -0.4474776  0.0456593  -9.8004 &lt; 2.2e-16 ***</span>
<span class="c1">## soilwatercons_ynYes      0.0585665  0.0275969   2.1222  0.033820 *</span>
<span class="c1">## nfert_kgha               0.2723653  0.0126521  21.5272 &lt; 2.2e-16 ***</span>
<span class="c1">## manure_ynYes             0.0373056  0.0261372   1.4273  0.153494</span>
<span class="c1">## residues_ynYes           0.0316401  0.0270959   1.1677  0.242925</span>
<span class="c1">## previous_cropLegume      0.0220438  0.0244585   0.9013  0.367442</span>
<span class="c1">## previous_cropOther       0.1230667  0.0264684   4.6496 3.326e-06 ***</span>
<span class="c1">## oxplough_freq_cat&gt;Five   0.0534308  0.0580652   0.9202  0.357475</span>
<span class="c1">## oxplough_freq_catFour   -0.0126670  0.0569799  -0.2223  0.824075</span>
<span class="c1">## oxplough_freq_catThree  -0.1015532  0.0573738  -1.7700  0.076722 .</span>
<span class="c1">## herb_lha                 0.0134322  0.0029268   4.5894 4.446e-06 ***</span>
<span class="c1">## handweeding_persdayha   -0.0038850  0.0020551  -1.8905  0.058697 .</span>
<span class="c1">## weeding_ynYes            0.0369644  0.0496531   0.7445  0.456602</span>
<span class="c1">## pesticide_ynYes          0.1208168  0.0495391   2.4388  0.014735 *</span>
<span class="c1">## disease_incidence_ynYes -0.3161391  0.0314308 -10.0582 &lt; 2.2e-16 ***</span>
<span class="c1">## pest_incidence_ynYes    -0.0857481  0.0733460  -1.1691  0.242367</span>
<span class="c1">## sigmaSq                  0.5977253  0.0250709  23.8414 &lt; 2.2e-16 ***</span>
<span class="c1">## gamma                    0.7421739  0.0246107  30.1565 &lt; 2.2e-16 ***</span>
<span class="c1">## ---</span>
<span class="c1">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span>
<span class="c1">## log likelihood value: -3066.353</span>
<span class="c1">##</span>
<span class="c1">## cross-sectional data</span>
<span class="c1">## total number of observations = 3694</span>
<span class="c1">##</span>
<span class="c1">## mean efficiency: 0.633058</span>
</pre></div>
</div>
<p>The simple Cobb-Douglas model fitted above can be made more complex by
adding second-order terms in what is known as a <strong>stochastic frontier
model with a translog functional form</strong>. This functional form is most
flexible as it considers non-linear relations between variables (squared
terms and interactions). Yet, the translog functional form should only
be fitted last to assess non-linear effects on crop yield as the large
number of parameters make it difficult to interpret. The functions
<em>sfa()</em> and <em>efficiencies()</em> are used again to estimate model parameters
and technical efficiency scores, respectively. Please note this output
is not displayed given the large number of parameters involved. To do
so, kindly remove the symbol # in the chunk of code below.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># fit translog stochastic frontier</span>
<span class="n">sfa_tl</span> <span class="o">&lt;-</span>
  <span class="nf">sfa</span><span class="p">(</span><span class="n">yield_tha</span> <span class="o">~</span>
   <span class="c1"># 1st order terms (linear)</span>
   <span class="n">season_year</span> <span class="o">+</span> <span class="n">gyga_gdd</span> <span class="o">+</span> <span class="n">gyga_tseas</span> <span class="o">+</span> <span class="n">seed_kgha</span> <span class="o">+</span> <span class="n">variety</span> <span class="o">+</span>
   <span class="n">gyga_ai</span> <span class="o">+</span> <span class="n">gyga_av_water</span> <span class="o">+</span> <span class="n">soil_depth</span> <span class="o">+</span> <span class="n">soil_fertility</span> <span class="o">+</span> <span class="n">waterlogging_yn</span> <span class="o">+</span> <span class="n">drought_yn</span> <span class="o">+</span> <span class="n">soilwatercons_yn</span> <span class="o">+</span>
   <span class="n">nfert_kgha</span> <span class="o">+</span> <span class="n">manure_yn</span> <span class="o">+</span> <span class="n">residues_yn</span> <span class="o">+</span> <span class="n">previous_crop</span> <span class="o">+</span> <span class="n">oxplough_freq_cat</span> <span class="o">+</span>
   <span class="n">herb_lha</span> <span class="o">+</span> <span class="n">handweeding_persdayha</span> <span class="o">+</span> <span class="n">weeding_yn</span> <span class="o">+</span> <span class="n">pesticide_yn</span> <span class="o">+</span> <span class="n">disease_incidence_yn</span> <span class="o">+</span> <span class="n">pest_incidence_yn</span> <span class="o">+</span>
   <span class="c1"># 2nd order terms (squared)</span>
   <span class="nf">I</span><span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">gyga_gdd</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">gyga_tseas</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">seed_kgha</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span>
   <span class="nf">I</span><span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">gyga_ai</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">gyga_av_water</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span>
   <span class="nf">I</span><span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">nfert_kgha</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span>
   <span class="nf">I</span><span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">herb_lha</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="m">0.5</span><span class="o">*</span><span class="n">handweeding_persdayha</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">+</span>
   <span class="c1"># 2nd order terms (interactions)</span>
   <span class="nf">I</span><span class="p">(</span><span class="n">gyga_gdd</span><span class="o">*</span><span class="n">gyga_tseas</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_gdd</span><span class="o">*</span><span class="n">seed_kgha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_gdd</span><span class="o">*</span><span class="n">gyga_ai</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_gdd</span><span class="o">*</span><span class="n">gyga_av_water</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">I</span><span class="p">(</span><span class="n">gyga_gdd</span><span class="o">*</span><span class="n">nfert_kgha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_gdd</span><span class="o">*</span><span class="n">herb_lha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_gdd</span><span class="o">*</span><span class="n">handweeding_persdayha</span><span class="p">)</span> <span class="o">+</span>
   <span class="nf">I</span><span class="p">(</span><span class="n">gyga_tseas</span><span class="o">*</span><span class="n">seed_kgha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_tseas</span><span class="o">*</span><span class="n">gyga_ai</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_tseas</span><span class="o">*</span><span class="n">gyga_av_water</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_tseas</span><span class="o">*</span><span class="n">nfert_kgha</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">I</span><span class="p">(</span><span class="n">gyga_tseas</span><span class="o">*</span><span class="n">herb_lha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_tseas</span><span class="o">*</span><span class="n">handweeding_persdayha</span><span class="p">)</span> <span class="o">+</span>
   <span class="nf">I</span><span class="p">(</span><span class="n">seed_kgha</span><span class="o">*</span><span class="n">gyga_ai</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">seed_kgha</span><span class="o">*</span><span class="n">gyga_av_water</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">seed_kgha</span><span class="o">*</span><span class="n">nfert_kgha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">seed_kgha</span><span class="o">*</span><span class="n">herb_lha</span><span class="p">)</span> <span class="o">+</span>
     <span class="nf">I</span><span class="p">(</span><span class="n">seed_kgha</span><span class="o">*</span><span class="n">handweeding_persdayha</span><span class="p">)</span> <span class="o">+</span>
   <span class="nf">I</span><span class="p">(</span><span class="n">gyga_ai</span><span class="o">*</span><span class="n">gyga_av_water</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_ai</span><span class="o">*</span><span class="n">nfert_kgha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_ai</span><span class="o">*</span><span class="n">herb_lha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_ai</span><span class="o">*</span><span class="n">handweeding_persdayha</span><span class="p">)</span> <span class="o">+</span>
   <span class="nf">I</span><span class="p">(</span><span class="n">gyga_av_water</span><span class="o">*</span><span class="n">nfert_kgha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_av_water</span><span class="o">*</span><span class="n">herb_lha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">gyga_av_water</span><span class="o">*</span><span class="n">handweeding_persdayha</span><span class="p">)</span> <span class="o">+</span>
   <span class="nf">I</span><span class="p">(</span><span class="n">nfert_kgha</span><span class="o">*</span><span class="n">herb_lha</span><span class="p">)</span> <span class="o">+</span> <span class="nf">I</span><span class="p">(</span><span class="n">nfert_kgha</span><span class="o">*</span><span class="n">handweeding_persdayha</span><span class="p">)</span> <span class="o">+</span>
   <span class="nf">I</span><span class="p">(</span><span class="n">herb_lha</span><span class="o">*</span><span class="n">handweeding_persdayha</span><span class="p">),</span>
   <span class="n">data</span><span class="o">=</span><span class="n">data_new</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># add technical efficiency score to data frame</span>
<span class="n">data_new</span><span class="o">$</span><span class="n">te_score_tl</span> <span class="o">=</span> <span class="nf">efficiencies</span><span class="p">(</span><span class="n">sfa_tl</span><span class="p">,</span> <span class="n">asInData</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># see parameter estimates</span>
<span class="c1"># summary(sfa_tl)</span>
</pre></div>
</div>
<p>The two chunks of code above added two new columns to the original data
frame, namely <strong>te_score_cd</strong> and <strong>te_score_tl</strong>. These technical
efficiency scores range between 0 and 1 and indicate how extra yield
could have been produced for the observed level of inputs. For instance,
if the technical efficiency score is equal to 0.2 for a specific field,
then that field only produced 20% of what it could have produced with
the level of inputs it received. The efficiency yield gap is the
agronomic equivalent of technical inefficiency when variables used in
the stochastic frontier analysis are selected based on concepts of
production ecology. Thus, Y<sub>TEx</sub> and the efficiency yield gap can
be estimated from the technical efficiency scores as follows.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># estimate efficiency yield gap (%)</span>
<span class="n">data_new</span><span class="p">[</span><span class="s">&#39;efficiency_yg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="m">100</span> <span class="o">-</span> <span class="p">(</span><span class="n">data_new</span><span class="p">[</span><span class="s">&#39;te_score_cd&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="m">100</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># select relevant columns</span>
<span class="n">data_new</span> <span class="o">&lt;-</span> <span class="n">data_new</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;zone_new&#39;</span><span class="p">,</span> <span class="s">&#39;season_year&#39;</span><span class="p">,</span> <span class="s">&#39;hhid&#39;</span><span class="p">,</span> <span class="s">&#39;plotid&#39;</span><span class="p">,</span> <span class="s">&#39;subplotid&#39;</span><span class="p">,</span> <span class="s">&#39;te_score_cd&#39;</span><span class="p">,</span> <span class="s">&#39;te_score_tl&#39;</span><span class="p">,</span>
                       <span class="s">&#39;efficiency_yg&#39;</span><span class="p">)]</span>
<span class="c1">#</span>
<span class="c1"># merge the new columns to original data frame</span>
<span class="n">data</span> <span class="o">&lt;-</span> <span class="nf">merge</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data_new</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;zone_new&#39;</span><span class="p">,</span> <span class="s">&#39;season_year&#39;</span><span class="p">,</span> <span class="s">&#39;hhid&#39;</span><span class="p">,</span> <span class="s">&#39;subplotid&#39;</span><span class="p">),</span> <span class="n">all.x</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># estimate technical efficiency yield (t/ha)</span>
<span class="n">data</span><span class="p">[</span><span class="s">&#39;ytex_tha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;yield_tha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;te_score_cd&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="resource-yield-gap">
<h2><strong>Resource yield gap</strong><a class="headerlink" href="#resource-yield-gap" title="Permalink to this headline">¶</a></h2>
<p>Before calculating Y<sub>HF</sub>, it is useful to categorize the
farm-fields into highest-, average-, and lowest-yielding based on the
distribution of the actual yield. Highest-yielding fields were
identified as the observations above the 90th percentile of Ya and the
highest farmers’ yields (Y<sub>HF</sub>) were computed as the mean Ya for
these fields. Similarly, the lowest-yielding fields were identified as
the observations below the 10th percentile of Ya (Y<sub>LF</sub>), and the
average-yielding fields as the observations between the 10th and the
90th percentile of Ya (Y<sub>AF</sub>).</p>
<p>The field classification described above needs to be done for a <strong>given
biophysical unit</strong>, composed in this case of a unique year x climate
zone x soil fertility combination, to avoid confounding between
environmental conditions and crop management. For wheat in Ethiopia,
‘year’ refers to the Meher seasons of 2009 and 2013, ‘climate zone’
refers to the units included in the climate delineation scheme of GYGA,
and ‘soil fertility’ refers to farmers’ own assessment of the fertility
of their soil. Variety type was not considered in the the field
classification because there was no significant yield difference between
variety types (see results of the Cobb-Douglas stochastic frontier model
above), but it should be considered otherwise.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># create an empty data frame</span>
<span class="n">data_final</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">()</span>
<span class="c1">#</span>
<span class="c1"># create loop per year</span>
<span class="nf">for</span><span class="p">(</span><span class="n">yr</span> <span class="n">in</span> <span class="nf">unique</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">year</span><span class="p">)){</span>
  <span class="n">subset_year</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">year</span> <span class="o">==</span> <span class="n">yr</span><span class="p">)</span>
  <span class="c1">#</span>
  <span class="c1"># create loop per climate zone</span>
  <span class="nf">for</span><span class="p">(</span><span class="n">cz</span> <span class="n">in</span> <span class="nf">unique</span><span class="p">(</span><span class="n">subset_year</span><span class="o">$</span><span class="n">gyga_cz</span><span class="p">)){</span>
    <span class="n">subset_cz</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">subset_year</span><span class="p">,</span> <span class="n">gyga_cz</span> <span class="o">==</span> <span class="n">cz</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># create loop per soil type</span>
    <span class="nf">for</span><span class="p">(</span><span class="n">soil</span> <span class="n">in</span> <span class="nf">unique</span><span class="p">(</span><span class="n">subset_cz</span><span class="o">$</span><span class="n">soil_fertility</span><span class="p">)){</span>
      <span class="n">subset_soil</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">subset_cz</span><span class="p">,</span> <span class="n">soil_fertility</span> <span class="o">==</span> <span class="n">soil</span><span class="p">)</span>
      <span class="c1"># create column with field class based on yield distribution</span>
      <span class="n">subset_soil</span><span class="o">$</span><span class="n">field_class</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">subset_soil</span><span class="o">$</span><span class="n">yield_tha</span> <span class="o">&gt;=</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">subset_soil</span><span class="o">$</span><span class="n">yield_tha</span><span class="p">,</span> <span class="m">0.90</span><span class="p">),</span>
                                           <span class="s">&#39;YHF&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
      <span class="n">subset_soil</span><span class="o">$</span><span class="n">field_class</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">subset_soil</span><span class="o">$</span><span class="n">yield_tha</span> <span class="o">&lt;=</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">subset_soil</span><span class="o">$</span><span class="n">yield_tha</span><span class="p">,</span> <span class="m">0.10</span><span class="p">),</span>
                                           <span class="s">&#39;YLF&#39;</span><span class="p">,</span> <span class="n">subset_soil</span><span class="o">$</span><span class="n">field_class</span><span class="p">)</span>
      <span class="n">subset_soil</span><span class="o">$</span><span class="n">field_class</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">subset_soil</span><span class="o">$</span><span class="n">yield_tha</span> <span class="o">&gt;</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">subset_soil</span><span class="o">$</span><span class="n">yield_tha</span><span class="p">,</span> <span class="m">0.10</span><span class="p">)</span> <span class="o">&amp;</span>
                                           <span class="n">subset_soil</span><span class="o">$</span><span class="n">yield_tha</span> <span class="o">&lt;</span> <span class="nf">quantile</span><span class="p">(</span><span class="n">subset_soil</span><span class="o">$</span><span class="n">yield_tha</span><span class="p">,</span> <span class="m">0.90</span><span class="p">),</span>
                                           <span class="s">&#39;YAF&#39;</span><span class="p">,</span> <span class="n">subset_soil</span><span class="o">$</span><span class="n">field_class</span><span class="p">)</span>
      <span class="c1">#</span>
      <span class="c1"># subset highest yielding fields only</span>
      <span class="n">yhf</span> <span class="o">&lt;-</span> <span class="nf">subset</span><span class="p">(</span><span class="n">subset_soil</span><span class="p">,</span> <span class="n">field_class</span> <span class="o">==</span> <span class="s">&#39;YHF&#39;</span><span class="p">)</span>
      <span class="c1">#</span>
      <span class="c1"># add column with yhf in t/ha to data frame</span>
      <span class="n">subset_soil</span><span class="p">[</span><span class="s">&#39;yhf_tha&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">mean</span><span class="p">(</span><span class="n">yhf</span><span class="o">$</span><span class="n">yield_tha</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
      <span class="c1">#</span>
      <span class="c1"># bind all individual fields into single data frame</span>
      <span class="n">data_final</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">subset_soil</span><span class="p">)</span>
<span class="p">}}}</span>
</pre></div>
</div>
<p>The chunk of code above implements the classification of fields as
highest-, average-, and lowest-yielding fields and the estimation of
Y<sub>HF</sub> for each field in the data set. The variables used for this
classification (i.e., year, climate zone, and soil fertility class) were
the most suitable for this specific example, meaning it is possible to
use other types of variables to control for differences in biophysical
conditions across fields (e.g., landscape position or slope), which will
depend on the data set and cropping systems at stake.</p>
</div>
<hr class="docutils" />
<div class="section" id="technology-yield-gap">
<h2><strong>Technology yield gap</strong><a class="headerlink" href="#technology-yield-gap" title="Permalink to this headline">¶</a></h2>
<p>The water-limited yield (Yw) is the yield benchmark for rainfed crops
(<a class="reference external" href="https://doi.org/10.1016/j.fcr.2012.09.009">van Ittersum et al.,
2013</a>), which is the case
of wheat in Ethiopia. Spatial-explicit data on Yw can be obtained from
different sources and a <strong>tier-approach</strong> is proposed for that. The most
preferred data source on yield ceilings is GYGA from which data can be
sourced through <a class="reference external" href="http://www.yieldgap.org">http://www.yieldgap.org</a> (an API to GYGA can also be
created on a demand basis). If the required data are not available in
GYGA, yield ceilings can be simulated with crop models or obtained
through literature review (least preferred option). Simulated yields in
GYGA refer to most recently released high-yield crop cultivars, grown in
pure stands. Yet, yield ceilings should be simulated for different
varieties when data are available and different varieties are known to
have different yield potential - see <a class="reference external" href="https://doi.org/10.1016/j.agsy.2022.103383">Silva et
al. (2022)</a> for an
example of how to consider yield gaps due to variety choice in the yield
gap decomposition framework used here.</p>
<p>The chunk of code below combines the water-limited yield data retrieved
from GYGA based on the GPS coordinates of the surveyed households to the
main database containing all field level data. The steps needed to
retrieve these data from the GYGA API are shown in a <strong>companion
notebook</strong>. Note: the water-limited yields presented here are slightly
different than those presented in <a class="reference external" href="https://doi.org/10.1007/s13593-020-00654-z">Silva et al.,
(2021)</a> due to different
criteria used to retrieve these data in the companion script.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># load dataframe with yw data</span>
<span class="n">file</span> <span class="o">&lt;-</span> <span class="s">&#39;https://raw.githubusercontent.com/jvasco323/EiA_YGD_workflow/main/data-gps-coordinates-final.csv&#39;</span>
<span class="n">yw_data</span> <span class="o">&lt;-</span> <span class="nf">read.csv</span><span class="p">(</span><span class="nf">url</span><span class="p">(</span><span class="n">file</span><span class="p">))</span>
<span class="n">yw_data</span> <span class="o">&lt;-</span> <span class="n">yw_data</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;hhid&#39;</span><span class="p">,</span> <span class="s">&#39;GYGA_CZ&#39;</span><span class="p">,</span> <span class="s">&#39;Yw_average&#39;</span><span class="p">,</span> <span class="s">&#39;Yw_2009&#39;</span><span class="p">,</span> <span class="s">&#39;Yw_2013&#39;</span><span class="p">)]</span>
<span class="n">yw_data</span> <span class="o">&lt;-</span> <span class="nf">unique</span><span class="p">(</span><span class="n">yw_data</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># merge yw data with the rest of the data</span>
<span class="n">data_final</span> <span class="o">&lt;-</span> <span class="nf">merge</span><span class="p">(</span><span class="n">data_final</span><span class="p">,</span> <span class="n">yw_data</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s">&#39;hhid&#39;</span><span class="p">,</span> <span class="n">all.x</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># get yw per field</span>
<span class="n">data_final</span><span class="o">$</span><span class="n">yw_tha</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data_final</span><span class="o">$</span><span class="n">year</span> <span class="o">==</span> <span class="m">2009</span><span class="p">,</span> <span class="n">data_final</span><span class="o">$</span><span class="n">Yw_2009</span><span class="p">,</span> <span class="n">data_final</span><span class="o">$</span><span class="n">Yw_2013</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># summarize of yw data</span>
<span class="n">summary_yw</span> <span class="o">&lt;-</span> <span class="nf">unique</span><span class="p">(</span><span class="n">data_final</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;GYGA_CZ&#39;</span><span class="p">,</span> <span class="s">&#39;Yw_average&#39;</span><span class="p">,</span> <span class="s">&#39;Yw_2009&#39;</span><span class="p">,</span> <span class="s">&#39;Yw_2013&#39;</span><span class="p">)])</span>
<span class="n">summary_yw</span> <span class="o">&lt;-</span> <span class="nf">aggregate</span><span class="p">(</span><span class="n">summary_yw</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">)],</span> <span class="n">by</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="s">&#39;GYGA_CZ&#39;</span><span class="o">=</span><span class="n">summary_yw</span><span class="o">$</span><span class="n">GYGA_CZ</span><span class="p">),</span> <span class="n">FUN</span><span class="o">=</span><span class="n">mean</span><span class="p">)</span>
<span class="n">summary_yw</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">4</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="nf">round</span><span class="p">(</span><span class="n">summary_yw</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">)],</span> <span class="m">1</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">summary_yw</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&#39;Climate zone&#39;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">summary_yw</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&#39;Yw long-term (t/ha)&#39;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">summary_yw</span><span class="p">)[</span><span class="m">3</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&#39;Yw 2009 (t/ha)&#39;</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">summary_yw</span><span class="p">)[</span><span class="m">4</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s">&#39;Yw 2013 (t/ha)&#39;</span>
<span class="n">DT</span><span class="o">::</span><span class="nf">datatable</span><span class="p">(</span><span class="n">summary_yw</span><span class="p">,</span>
              <span class="n">options</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">pageLength</span><span class="o">=</span><span class="m">5</span><span class="p">,</span>
                           <span class="n">lengthMenu</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">15</span><span class="p">)))</span>
<span class="c1">## Error in loadNamespace(name): there is no package called &#39;DT&#39;</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="yield-gap-decomposition">
<h2><strong>Yield gap decomposition</strong><a class="headerlink" href="#yield-gap-decomposition" title="Permalink to this headline">¶</a></h2>
<p>The four yield levels needed for yield gap decomposition were calculated
in the previous section. At last, the intermediate yield gaps need to be
estimated in t/ha and in terms of yield gap closure, i.e., relative to
Yw. This what the chunk of code below implements. With all this
information in hand, a summary figure showing the <strong>yield gap
decomposition</strong> for units of interest can be produced. This is
exemplified here for different administrative regions and for different
farming systems.</p>
<p>Below is the code for estimating the <strong>yield gaps in t/ha</strong>. Please note
automation is needed for data sets spanning over many years, but the
general principle is the same.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># total yield gap in t/ha</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yg_total_2009&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2009&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yield_tha&#39;</span><span class="p">]</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yg_total_2013&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2013&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yield_tha&#39;</span><span class="p">]</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yg_total&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data_final</span><span class="o">$</span><span class="n">year</span> <span class="o">==</span> <span class="m">2009</span><span class="p">,</span> <span class="n">data_final</span><span class="o">$</span><span class="n">yg_total_2009</span><span class="p">,</span>
                                                          <span class="n">data_final</span><span class="o">$</span><span class="n">yg_total_2013</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># efficiency yield gap in t/ha</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;eff_yg_tha_2009&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;ytex_tha&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yield_tha&#39;</span><span class="p">]</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;eff_yg_tha_2013&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;ytex_tha&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yield_tha&#39;</span><span class="p">]</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;eff_yg_tha&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data_final</span><span class="o">$</span><span class="n">year</span> <span class="o">==</span> <span class="m">2009</span><span class="p">,</span> <span class="n">data_final</span><span class="o">$</span><span class="n">eff_yg_tha_2009</span><span class="p">,</span>
                                                            <span class="n">data_final</span><span class="o">$</span><span class="n">eff_yg_tha_2013</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># resource yield gap in t/ha</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;res_yg_tha_2009&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yhf_tha&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;ytex_tha&#39;</span><span class="p">]</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;res_yg_tha_2013&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yhf_tha&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;ytex_tha&#39;</span><span class="p">]</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;res_yg_tha&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data_final</span><span class="o">$</span><span class="n">year</span> <span class="o">==</span> <span class="m">2009</span><span class="p">,</span> <span class="n">data_final</span><span class="o">$</span><span class="n">res_yg_tha_2009</span><span class="p">,</span>
                                                            <span class="n">data_final</span><span class="o">$</span><span class="n">res_yg_tha_2013</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># technology yield gap in t/ha</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;tech_yg_tha_2009&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2009&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yhf_tha&#39;</span><span class="p">]</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;tech_yg_tha_2013&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2013&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yhf_tha&#39;</span><span class="p">]</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;tech_yg_tha&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data_final</span><span class="o">$</span><span class="n">year</span> <span class="o">==</span> <span class="m">2009</span><span class="p">,</span> <span class="n">data_final</span><span class="o">$</span><span class="n">tech_yg_tha_2009</span><span class="p">,</span>
                                                             <span class="n">data_final</span><span class="o">$</span><span class="n">tech_yg_tha_2013</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># aggregate absolute yield gaps by zone</span>
<span class="n">absolute</span> <span class="o">&lt;-</span> <span class="nf">aggregate</span><span class="p">(</span><span class="n">data_final</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;yield_tha&#39;</span><span class="p">,</span> <span class="s">&#39;eff_yg_tha&#39;</span><span class="p">,</span> <span class="s">&#39;res_yg_tha&#39;</span><span class="p">,</span> <span class="s">&#39;tech_yg_tha&#39;</span><span class="p">)],</span> <span class="n">by</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="s">&#39;zone_new&#39;</span><span class="o">=</span><span class="n">data_final</span><span class="o">$</span><span class="n">zone_new</span><span class="p">),</span> <span class="n">FUN</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="n">absolute_t</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="n">absolute</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">absolute_t</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">absolute</span><span class="o">$</span><span class="n">zone_new</span>
<span class="n">absolute_t</span> <span class="o">&lt;-</span> <span class="n">absolute_t</span><span class="p">[</span><span class="m">-1</span><span class="p">,</span> <span class="p">]</span>
<span class="c1">#</span>
<span class="c1"># make barplot</span>
<span class="n">pal</span> <span class="o">&lt;-</span> <span class="nf">rev</span><span class="p">(</span><span class="nf">palette</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Blues&quot;</span><span class="p">)))</span>
<span class="n">pal</span> <span class="o">&lt;-</span> <span class="nf">rev</span><span class="p">(</span><span class="nf">palette</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Blues&quot;</span><span class="p">)))</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">9</span><span class="p">),</span> <span class="n">yaxs</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">)</span>
<span class="p">{</span><span class="nf">barplot</span><span class="p">(</span><span class="n">absolute_t</span><span class="p">,</span>
         <span class="n">las</span><span class="o">=</span><span class="m">2</span><span class="p">,</span>
         <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.1</span><span class="p">,</span>
         <span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span>
         <span class="n">ylab</span><span class="o">=</span><span class="s">&#39;Yield and yield gaps (t/ha)&#39;</span><span class="p">,</span>
         <span class="n">main</span><span class="o">=</span><span class="s">&#39;Yield gap decomposition for wheat in Ethiopia (t/ha)&#39;</span><span class="p">,</span>
         <span class="n">col</span><span class="o">=</span><span class="n">pal</span><span class="p">)</span>
 <span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">9</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
 <span class="nf">legend</span><span class="p">(</span><span class="s">&quot;topright&quot;</span><span class="p">,</span>
        <span class="n">inset</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-0.325</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
        <span class="n">legend</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Technology Yg&quot;</span><span class="p">,</span> <span class="s">&quot;Resource Yg&quot;</span><span class="p">,</span> <span class="s">&quot;Efficiency Yg&quot;</span><span class="p">,</span> <span class="s">&quot;Actual yield&quot;</span><span class="p">),</span>
        <span class="n">fill</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">palette</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Blues&quot;</span><span class="p">))),</span>
        <span class="n">xpd</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
 <span class="nf">box</span><span class="p">()}</span>
</pre></div>
</div>
<p><img alt="image2" src="../../_images/unnamed-chunk-11-1.png" /></p>
<p>Below is the code for estimating the <strong>yield gap closure relative to
Yw</strong>. Please note automation is needed for data sets spanning over many
years, but the general principle is the same.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># yield gap closure relative to yw</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yg_closure_2009&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yield_tha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2009&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="m">100</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yg_closure_2013&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yield_tha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2013&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="m">100</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yg_closure&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data_final</span><span class="o">$</span><span class="n">year</span> <span class="o">==</span> <span class="m">2009</span><span class="p">,</span> <span class="n">data_final</span><span class="o">$</span><span class="n">yg_closure_2009</span><span class="p">,</span>
                                                            <span class="n">data_final</span><span class="o">$</span><span class="n">yg_closure_2013</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># ytex relative to yw</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;eff_yg_2009&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">data_final</span><span class="p">[</span><span class="s">&#39;ytex_tha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2009&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="m">100</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;eff_yg_2013&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">data_final</span><span class="p">[</span><span class="s">&#39;ytex_tha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2013&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="m">100</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;ytex_closure&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data_final</span><span class="o">$</span><span class="n">year</span> <span class="o">==</span> <span class="m">2009</span><span class="p">,</span> <span class="n">data_final</span><span class="o">$</span><span class="n">eff_yg_2009</span><span class="p">,</span>
                                                              <span class="n">data_final</span><span class="o">$</span><span class="n">eff_yg_2013</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># yhf relative to yw</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;res_yg_2009&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yhf_tha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2009&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="m">100</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;res_yg_2013&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="p">(</span><span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yhf_tha&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">data_final</span><span class="p">[</span><span class="s">&#39;Yw_2013&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="m">100</span>
<span class="n">data_final</span><span class="p">[</span><span class="s">&#39;yhf_closure&#39;</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">data_final</span><span class="o">$</span><span class="n">year</span> <span class="o">==</span> <span class="m">2009</span><span class="p">,</span> <span class="n">data_final</span><span class="o">$</span><span class="n">res_yg_2009</span><span class="p">,</span>
                                                             <span class="n">data_final</span><span class="o">$</span><span class="n">res_yg_2013</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># intermediate yield gaps</span>
<span class="n">data_final</span><span class="o">$</span><span class="n">eff_yg</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="o">$</span><span class="n">ytex_closure</span> <span class="o">-</span> <span class="n">data_final</span><span class="o">$</span><span class="n">yg_closure</span>
<span class="n">data_final</span><span class="o">$</span><span class="n">res_yg</span> <span class="o">&lt;-</span> <span class="n">data_final</span><span class="o">$</span><span class="n">yhf_closure</span> <span class="o">-</span> <span class="n">data_final</span><span class="o">$</span><span class="n">ytex_closure</span>
<span class="n">data_final</span><span class="o">$</span><span class="n">tech_yg</span> <span class="o">&lt;-</span> <span class="m">100</span> <span class="o">-</span> <span class="n">data_final</span><span class="o">$</span><span class="n">yhf_closure</span>
<span class="c1">#</span>
<span class="c1"># aggregate absolute yield gaps by zone</span>
<span class="n">relative</span> <span class="o">&lt;-</span> <span class="nf">aggregate</span><span class="p">(</span><span class="n">data_final</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="s">&#39;yg_closure&#39;</span><span class="p">,</span> <span class="s">&#39;eff_yg&#39;</span><span class="p">,</span> <span class="s">&#39;res_yg&#39;</span><span class="p">,</span> <span class="s">&#39;tech_yg&#39;</span><span class="p">)],</span> <span class="n">by</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="s">&#39;zone_new&#39;</span><span class="o">=</span><span class="n">data_final</span><span class="o">$</span><span class="n">zone_new</span><span class="p">),</span> <span class="n">FUN</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
<span class="n">relative_t</span> <span class="o">&lt;-</span> <span class="nf">t</span><span class="p">(</span><span class="n">relative</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">relative_t</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">relative</span><span class="o">$</span><span class="n">zone_new</span>
<span class="n">relative_t</span> <span class="o">&lt;-</span> <span class="n">relative_t</span><span class="p">[</span><span class="m">-1</span><span class="p">,</span> <span class="p">]</span>
<span class="c1">#</span>
<span class="c1"># make barplot</span>
<span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="n">mar</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">9</span><span class="p">),</span> <span class="n">yaxs</span><span class="o">=</span><span class="s">&#39;i&#39;</span><span class="p">)</span>
<span class="p">{</span><span class="nf">barplot</span><span class="p">(</span><span class="n">relative_t</span><span class="p">,</span>
         <span class="n">las</span><span class="o">=</span><span class="m">2</span><span class="p">,</span>
         <span class="n">cex.lab</span><span class="o">=</span><span class="m">1.1</span><span class="p">,</span>
         <span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">100</span><span class="p">),</span>
         <span class="n">ylab</span><span class="o">=</span><span class="s">&#39;Yield gap closure (% of Yw)&#39;</span><span class="p">,</span>
         <span class="n">main</span><span class="o">=</span><span class="s">&#39;Yield gap decomposition for wheat in Ethiopia (%)&#39;</span><span class="p">,</span>
         <span class="n">col</span><span class="o">=</span><span class="n">pal</span><span class="p">)</span>
 <span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">50</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">lty</span><span class="o">=</span><span class="m">2</span><span class="p">)</span>
 <span class="nf">abline</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="m">80</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">lty</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
 <span class="nf">legend</span><span class="p">(</span><span class="s">&quot;topright&quot;</span><span class="p">,</span>
        <span class="n">inset</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">-0.325</span><span class="p">,</span> <span class="m">0</span><span class="p">),</span>
        <span class="n">legend</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;Technology Yg&quot;</span><span class="p">,</span> <span class="s">&quot;Resource Yg&quot;</span><span class="p">,</span> <span class="s">&quot;Efficiency Yg&quot;</span><span class="p">,</span> <span class="s">&quot;Actual yield&quot;</span><span class="p">),</span>
        <span class="n">fill</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nf">palette</span><span class="p">(</span><span class="nf">brewer.pal</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="m">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;Blues&quot;</span><span class="p">))),</span>
        <span class="n">xpd</span><span class="o">=</span><span class="bp">T</span><span class="p">)</span>
 <span class="nf">box</span><span class="p">()}</span>
</pre></div>
</div>
<p><img alt="image3" src="../../_images/unnamed-chunk-12-1.png" /></p>
</div>
<hr class="docutils" />
<div class="section" id="recommendations">
<h2><strong>Recommendations</strong><a class="headerlink" href="#recommendations" title="Permalink to this headline">¶</a></h2>
<p>The work flow described in this notebook was applied to a wide range of
(cereal) cropping systems worldwide. The relative importance of the
three intermediate yield gaps, as well as inter-linkages between them,
depend on the degree of yield gap closure (i.e., level of
intensification) of the cropping system/dataset in question. The
experiences learned so far with the application of this framework across
contrasting cropping systems can be summarized as follows:</p>
<ul class="simple">
<li><p><strong>Low yielding cereal crops in Ethiopia and Zambia:</strong> Large
importance of the technology yield gap, which is often confounded
with the resource yield gap, because inputs used in highest yielding
fields is way below the inputs needed to reach the water-limited
yield. Possible confounds between the technology and efficiency yield
gaps is also possible when resource-use efficiency observed on-farm
is way below what is agronomically possible (due to e.g., poor crop
establishment or poor management of pests, diseases, and weeds). For
further examples and information see <a class="reference external" href="https://doi.org/10.1007/s12571-019-00981-4">Assefa et
al. (2020)</a>, <a class="reference external" href="https://doi.org/10.1007/s13593-020-00654-z">Silva et
al., (2021)</a>, and
<a class="reference external" href="https://doi.org/10.1007/s13593-023-00872-1">Silva et al. (2023)</a>.</p></li>
<li><p><strong>Intermediate yielding cereal crops in the Philippines:</strong> Similar
relative importance of efficiency, resource, and technology yield
gaps. This means that yield gaps in such cropping systems are
explained by a multitude of factors: sub-optimal time, space, form,
and rate of input use and technologies used on-farm not being able to
reach the potential or water-limited yield. Such patterns have also
been observed for other rice cropping systems in Southeast Asia
(e.g., Thailand). For further examples and information see <a class="reference external" href="https://doi.org/10.1016/j.eja.2016.06.017">Silva et
al. (2017)</a> and <a class="reference external" href="https://doi.org/10.1016/j.agsy.2022.103383">Silva
et al. (2022)</a>.</p></li>
<li><p><strong>High yielding cereal crops in the Netherlands and NW India:</strong> Small
resource yield gap and the also small total yield gap is equally
explained by efficiency and technology yield gaps. It is questionable
to focus only on explaining yield gaps in such cropping systems, as
often there is scope to reduce input use without compromising yield.
It is thus important to complement such analysis with studies on
resource-use efficiency, and to consider pests, diseases, and weeds
as these are often responsible for the small yield gaps observed. For
further examples and information see <a class="reference external" href="https://doi.org/10.1016/j.agsy.2017.06.005">Silva et
al. (2017)</a> and <a class="reference external" href="https://doi.org/10.1016/j.fcr.2021.108328">Nayak
et al. (2022)</a>.</p></li>
</ul>
<p>The framework has <strong>limitations</strong> that users must be aware of. Firstly,
the framework takes a production perspective and does not consider
profitability or links to policy explicitly. An example on how to do so
can be found in <a class="reference external" href="https://doi.org/10.1016/j.agsy.2017.03.004">van Dijk et
al. (2017)</a>. Secondly,
yield ceilings only consider a limited set of climatic, edaphic, and
management factors, which might overestimate the yields (and hence the
technology yield gap) that can potentially be obtained in practice. For
instance, soil acidity can be a serious constraint to crop yields in
some areas and such effects are not captured in the yield ceilings
simulated (<a class="reference external" href="https://doi.org/10.1007/s13593-023-00872-1">Silva et al.,
2023</a>). It is thus
recommended to compare the simulated yield ceilings against experimental
trial data under optimal conditions. Thirdly, conclusions derived from
the interpretation of resource yield gaps must be contextualized with
knowledge about the farming system. For instance, promoting greater
amounts of inputs might be detrimental to farmers in dryland areas with
erratic rainfall (<a class="reference external" href="https://doi.org/10.1007/s13593-023-00872-1">Silva et al.,
2023</a>) whereas in other
regions promoting increased fertilizer use might lead to increased
disease pressure (<a class="reference external" href="https://doi.org/10.1016/j.agsy.2022.103383">Silva et al.,
2022</a>). Lastly, it is
difficult to derive concrete recommendations to narrow efficiency yield
gaps as the associated crop management to do so is highly context
specific. Further research is on-going to improve some of these aspects.</p>
</div>
<hr class="docutils" />
<div class="section" id="acknowledgments">
<h2><strong>Acknowledgments</strong><a class="headerlink" href="#acknowledgments" title="Permalink to this headline">¶</a></h2>
<p>I thank Martin van Ittersum (WUR-PPS), Andy McDonald (Cornell CALS) and
Johan Ninanya (CIP-Peru) for constructive comments in an earlier version
of this workflow and Marloes van Loon (WUR-PPS) for retrieving the yield
ceiling data from the Global Yield Gap Atlas. The development of this
notebook was possible thanks to the financial support from the OneCGIAR
initiative on <em>Excellence in Agronomy</em>. For further support and
questions on how to implement this workflow to other data sets should be
addressed to J.V. Silva (<strong>j.silva&#64;cgiar.org</strong>).</p>
</div>
</div>
           </div>
          </div>
<footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="2-YGD-gyga-data.html" class="btn btn-neutral float-right" title="Retrieve data from GYGA" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
        <a href="../index.html" class="btn btn-neutral float-left" title="Stochastic frontier analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
    </div>
  <hr/>
  <div role="contentinfo">
    <p>
    </p>
  </div> 
<p style="text-align:right;">
<small>
  © Copyright 2023. License: <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>. <a href="https://github.com/jvasco323/eia-yg-training">Source code</a>.
</small>
</p>
<script data-ad-client="ca-pub-8587731620693273" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</footer>
        </div>
      </div>
    </section>
  </div>
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
</body>
</html>
